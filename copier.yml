# Copier template configuration for ML Research Projects
# PyTorch Lightning + Hydra template for machine learning research

_min_copier_version: "9.0.0"

# ============================================================================
# User questions - ProjectåŸºæœ¬æƒ…å ±
# ============================================================================

project_name:
  type: str
  help: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (Enterã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã‚’ä½¿ç”¨)"
  default: "{{ _copier_conf.dst_path.name }}"

package_name:
  type: str
  help: "ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (Pythonã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆåã€é€šå¸¸ã¯ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹)"
  default: "{{ project_name | replace('-', '_') }}"

description:
  type: str
  help: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®çŸ­ã„èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
  default: "A machine learning research project with PyTorch Lightning and Hydra"

author_name:
  type: str
  help: "ä½œè€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
  default: "Your Name"

author_email:
  type: str
  help: "ä½œè€…ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
  default: "your.email@example.com"

python_version:
  type: str
  help: "å¯¾è±¡ã¨ã™ã‚‹æœ€å°Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„"
  default: "3.10"
  choices:
    - "3.10"
    - "3.11"
    - "3.12"
    - "3.13"

# ============================================================================
# User questions - Package Manager
# ============================================================================

package_manager:
  type: str
  help: "ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„"
  default: "uv"
  choices:
    "uv (é«˜é€Ÿã€pipäº’æ›)": "uv"
    "pixi (Condaã€GPUè‡ªå‹•è¨­å®š)": "pixi"

# ============================================================================
# User questions - é–‹ç™ºãƒ„ãƒ¼ãƒ«è¨­å®š
# ============================================================================

use_ruff:
  type: bool
  help: "Ruff (é«˜é€Ÿlinter/formatter) ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: true

use_ty:
  type: bool
  help: "ty (é«˜é€Ÿå‹ãƒã‚§ãƒƒã‚«ãƒ¼ by Astral) ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: true

use_pytest:
  type: bool
  help: "Pytest (ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯) ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: true

use_github_actions:
  type: bool
  help: "GitHub Actions CI/CDã‚’è¨­å®šã—ã¾ã™ã‹ï¼Ÿ"
  default: true

use_nix:
  type: bool
  help: "Nix + direnv ã«ã‚ˆã‚‹é–‹ç™ºç’°å¢ƒç®¡ç†ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: false

# ============================================================================
# User questions - PyTorch/CUDA configuration
# ============================================================================

pytorch_cuda_preset:
  type: str
  help: "PyTorch + CUDAã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„"
  default: "pytorch-2.8.0-cuda-12.6"
  choices:
    "PyTorch 2.8.0 + CUDA 12.6 (æ¨å¥¨ãƒ»å®‰å®šç‰ˆ)": "pytorch-2.8.0-cuda-12.6"
    "PyTorch 2.9.0 + CUDA 12.6 (æœ€æ–°)": "pytorch-2.9.0-cuda-12.6"
    "PyTorch 2.9.0 + CUDA 13.0": "pytorch-2.9.0-cuda-13.0"
    "PyTorch 2.8.0 + CUDA 12.8": "pytorch-2.8.0-cuda-12.8"
    "PyTorch 2.7.1 + CUDA 12.6": "pytorch-2.7.1-cuda-12.6"
    "PyTorch 2.7.1 + CUDA 11.8": "pytorch-2.7.1-cuda-11.8"
    "PyTorch 2.6.0 + CUDA 12.4": "pytorch-2.6.0-cuda-12.4"
    "PyTorch 2.5.1 + CUDA 12.1": "pytorch-2.5.1-cuda-12.1"
    "PyTorch 2.4.1 + CUDA 11.8": "pytorch-2.4.1-cuda-11.8"
    "Custom (æ‰‹å‹•è¨­å®š)": "custom"

pytorch_version:
  type: str
  help: "PyTorchãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 2.9.0, 2.8.0ï¼‰"
  default: "2.8.0"
  when: "{{ pytorch_cuda_preset == 'custom' }}"

cuda_version:
  type: str
  help: "CUDAãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 12.6, 12.4, 11.8ï¼‰"
  default: "12.6"
  when: "{{ pytorch_cuda_preset == 'custom' }}"

use_torchvision:
  type: bool
  help: "torchvisionã‚’å«ã‚ã¾ã™ã‹ï¼Ÿ"
  default: true

use_torchaudio:
  type: bool
  help: "torchaudioã‚’å«ã‚ã¾ã™ã‹ï¼Ÿ"
  default: false

# ============================================================================
# User questions - ML Framework configuration
# ============================================================================

use_lightning:
  type: bool
  help: "PyTorch Lightningã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: true

lightning_version:
  type: str
  help: "PyTorch Lightningã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„"
  default: "2.4"
  choices:
    - "2.4"
    - "2.3"
    - "2.2"
  when: "{{ use_lightning }}"

use_hydra:
  type: bool
  help: "Hydraã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿï¼ˆè¨­å®šç®¡ç†ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼‰"
  default: true

hydra_version:
  type: str
  help: "Hydraã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„"
  default: "1.3"
  choices:
    - "1.3"
    - "1.2"
  when: "{{ use_hydra }}"

use_pytorch_geometric:
  type: bool
  help: "PyTorch Geometric (GNN) ã‚’ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ"
  default: false

# ============================================================================
# User questions - Experiment tracking
# ============================================================================

logger_choice:
  type: str
  help: "å®Ÿé¨“ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ç”¨ã®ãƒ­ã‚¬ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„"
  default: "tensorboard"
  choices:
    "TensorBoard (ã‚·ãƒ³ãƒ—ãƒ«)": "tensorboard"
    "Weights & Biases (é«˜æ©Ÿèƒ½)": "wandb"
    "MLflow (ã‚ªãƒ³ãƒ—ãƒ¬å‘ã‘)": "mlflow"
    "ä¸¡æ–¹ (TensorBoard + W&B)": "both"
    "ãªã—": "none"

wandb_entity:
  type: str
  help: "W&B entityåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆãƒãƒ¼ãƒ ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼‰"
  default: ""
  when: "{{ logger_choice in ['wandb', 'both'] }}"

# ============================================================================
# User questions - Project template type
# ============================================================================

template_type:
  type: str
  help: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„"
  default: "image-classification"
  choices:
    "ç”»åƒåˆ†é¡ (Image Classification)": "image-classification"
    "ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (Segmentation)": "segmentation"
    "ç‰©ä½“æ¤œå‡º (Object Detection)": "object-detection"
    "ãƒ†ã‚­ã‚¹ãƒˆåˆ†é¡ (Text Classification)": "text-classification"
    "GNN (Graph Neural Network)": "gnn"
    "ã‚«ã‚¹ã‚¿ãƒ  (Minimal Template)": "minimal"

dataset_choice:
  type: str
  help: "åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ç”¨ï¼‰"
  default: "mnist"
  choices:
    "MNIST (æ‰‹æ›¸ãæ•°å­—)": "mnist"
    "CIFAR-10 (ç”»åƒ10ã‚¯ãƒ©ã‚¹)": "cifar10"
    "CIFAR-100 (ç”»åƒ100ã‚¯ãƒ©ã‚¹)": "cifar100"
    "Fashion-MNIST": "fashion-mnist"
    "ã‚«ã‚¹ã‚¿ãƒ ": "custom"
  when: "{{ template_type == 'image-classification' }}"

# ============================================================================
# File/directory exclusion settings
# ============================================================================

_exclude:
  - "copier.yml"
  - "copier.yaml"
  - ".git"
  - ".venv"
  - "__pycache__"
  - "*.pyc"
  - ".pytest_cache"
  - ".ruff_cache"
  - "uv.lock"
  - "pixi.lock"
  - ".pixi"
  - "dist"
  - "build"
  - "*.egg-info"
  - "{% if not use_ruff %}ruff.toml.jinja{% endif %}"
  - "{% if not use_nix %}.envrc.jinja{% endif %}"
  - "{% if not use_github_actions %}.github{% endif %}"
  - "{% if template_type != 'gnn' %}src/{{ package_name }}/models/gnn{% endif %}"
  - "{% if template_type != 'segmentation' %}src/{{ package_name }}/models/segmentation{% endif %}"

# ============================================================================
# Post-generation tasks
# ============================================================================

_tasks:
  - "git init -b main"
  - "git add ."
  - "{% if package_manager == 'uv' %}uv venv{% else %}echo 'Skipping uv venv (using pixi)'{% endif %}"
  - "{% if package_manager == 'uv' %}uv lock{% else %}echo 'Skipping uv lock (using pixi)'{% endif %}"
  - "{% if package_manager == 'uv' %}uv sync{% else %}pixi install{% endif %}"
  - "{% if use_ruff and package_manager == 'uv' %}uv run ruff check . --fix || true{% elif use_ruff %}pixi run ruff check . --fix || true{% else %}echo 'Skipping ruff check'{% endif %}"
  - "{% if use_ruff and package_manager == 'uv' %}uv run ruff format .{% elif use_ruff %}pixi run ruff format .{% else %}echo 'Skipping ruff format'{% endif %}"
  - "{% if use_ty and package_manager == 'uv' %}uv run ty check || true{% elif use_ty %}pixi run ty check || true{% else %}echo 'Skipping ty check'{% endif %}"
  - "{% if use_pytest and package_manager == 'uv' %}uv run pytest || true{% elif use_pytest %}pixi run pytest || true{% else %}echo 'Skipping pytest'{% endif %}"
  - "echo 'âœ… Quality checks completed!'"

  # Success message
  - |
    echo "
    ============================================================
    ğŸ‰ MLç ”ç©¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸï¼
    ============================================================

    ğŸ“¦ Project: {{ project_name }}
    ğŸ”¥ PyTorch: {{ pytorch_version }} + CUDA {{ cuda_version }}
    {% if use_lightning -%}
    âš¡ Lightning: {{ lightning_version }}
    {% endif -%}
    {% if use_hydra -%}
    ğŸ‰ Hydra: {{ hydra_version }}
    {% endif -%}
    ğŸ“Š Logger: {{ logger_choice }}

    æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:
      1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•:
         cd {{ _copier_conf.dst_path }}

      2. åˆå›ã‚³ãƒŸãƒƒãƒˆ (ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ—¢ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°æ¸ˆã¿):
         git commit -m \"chore: initial commit from ml-research template\"

      3. é–‹ç™ºã‚’é–‹å§‹:
         uv run python src/{{ package_name }}/train.py     # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é–‹å§‹
         uv run pytest tests/ -v                            # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
         uv run ruff format .                               # ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

      4. CUDAå‹•ä½œç¢ºèª:
         uv run python -c 'import torch; print(f\"CUDA available: {torch.cuda.is_available()}\")'

    {% if logger_choice == 'tensorboard' -%}
    ğŸ“Š TensorBoard: tensorboard --logdir logs/
    {% endif -%}
    {% if logger_choice in ['wandb', 'both'] -%}
    ğŸ“Š W&B: wandb login ã—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„
    {% endif -%}

    ğŸ“– è©³ç´°: README.md ã‚’å‚ç…§ã—ã¦ãã ã•ã„

    ============================================================
    "
